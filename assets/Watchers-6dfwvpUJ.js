import{B as ee,o as le,r as g,z as S,E as b,k as te,C as ne,c as r,a as s,f as n,d as o,w as u,F as m,g as y,i as l,p as k,u as K,q as H,t as d}from"./index-BQcwO47v.js";import{a as f}from"./chunk-2RP4XPBM-nGvCzmzp.js";import"./chunk-PC2QB7VM-DflWmKnP.js";const oe={key:0},ue={key:1},de={__name:"Watchers",setup(ae){const v=ee();le(()=>{$(),W()});const P=g(1);S(P,async(a,e)=>{b.success(`newValue: ${a}, oldValue: ${e}`)});const C=()=>({fullName:f.person.fullName(),address:{country:f.location.country(),city:f.location.city(),street:f.location.streetAddress(),zipCode:f.location.zipCode()}}),F=g(v.onceFlag),I=a=>{v.$patch(e=>{e.onceFlag=a}),U(),$(),B(),W()},N=g(v.immediateFlag),J=a=>{v.$patch(e=>{e.immediateFlag=a}),U(),$(),B(),W()},T=g(v.deepFlag),Q=a=>{v.$patch(e=>{e.deepFlag=a}),U(),$(),B(),W()},z=g(C()),X=()=>{z.value=C()},Y=()=>{z.value.fullName=f.person.fullName(),z.value.address.city=f.location.city()};let R=null;const $=()=>{R||(R=S(z,async(a,e)=>{b.success(`ref watch: [newValue: ${a.fullName}, oldValue: ${e?e.fullName:""}]`)},{deep:T.value,once:F.value,immediate:N.value}))},U=()=>{R(),R=null};let V=te(C());const Z=()=>{let a=C();for(let e in a)V[e]=a[e]},_=()=>{V.fullName=f.person.fullName(),V.address.city=f.location.city()};let M=null;const W=()=>{M||(M=S(V,async(a,e)=>{b.success(`reactive watch: [newValue: ${a.fullName}, oldValue: ${e?e.fullName:""}]`)},{once:F.value,immediate:N.value}))},B=()=>{M(),M=null},x=g(!1),w=g(""),L=g(""),j=g([]);return ne(a=>{if(!w.value){j.value=[];return}x.value=!0,L.value=w.value,b.primary(`正在请求, keyword: ${w.value}`);let e=!1;a(()=>{x.value&&(b.error(`取消请求, keyword: ${L.value}`),e=!0)}),setTimeout(()=>{e||(j.value=Array.from({length:Math.floor(Math.random()*10)+1},()=>({id:f.string.uuid(),title:f.word.words({count:Math.floor(Math.random()*10)+1})})),x.value=!1,b.success(`请求成功, keyword: ${w.value}`))},1e3*(Math.floor(Math.random()*10)+1))}),(a,e)=>{const h=y("el-input-number"),q=y("el-card"),i=y("el-tag"),A=y("el-checkbox"),G=y("el-divider"),E=y("el-button"),c=y("el-input");return s(),r(m,null,[n(q,null,{header:u(()=>e[8]||(e[8]=[l("监听数据")])),default:u(()=>[n(h,{modelValue:P.value,"onUpdate:modelValue":e[0]||(e[0]=t=>P.value=t),min:1,max:10},null,8,["modelValue"])]),_:1}),e[45]||(e[45]=o("br",null,null,-1)),n(q,null,{header:u(()=>e[9]||(e[9]=[l(" 监听对象 ")])),default:u(()=>[n(i,{type:"danger",size:"large",style:{"font-size":".8em","font-weight":"bold"}},{default:u(()=>e[10]||(e[10]=[l("once、immediate、deep 在watch注册时已经赋值，切换时需要【关闭侦听】再【开启侦听】")])),_:1,__:[10]}),e[30]||(e[30]=o("br",null,null,-1)),n(i,{type:"danger",size:"large",style:{"font-size":".8em","font-weight":"bold"}},{default:u(()=>e[11]||(e[11]=[l("【关闭侦听】：使用注册watch的返回函数")])),_:1,__:[11]}),e[31]||(e[31]=o("br",null,null,-1)),o("div",null,[e[12]||(e[12]=o("span",null,"一次回调(once)",-1)),e[13]||(e[13]=l("   ")),n(A,{modelValue:F.value,"onUpdate:modelValue":e[1]||(e[1]=t=>F.value=t),onChange:e[2]||(e[2]=t=>I(t))},null,8,["modelValue"])]),o("div",null,[e[14]||(e[14]=o("span",null,"立即回调(immediate)",-1)),e[15]||(e[15]=l("   ")),n(A,{modelValue:N.value,"onUpdate:modelValue":e[3]||(e[3]=t=>N.value=t),onChange:e[4]||(e[4]=t=>J(t))},null,8,["modelValue"])]),o("div",null,[e[17]||(e[17]=o("span",null,"深层侦听(deep)",-1)),e[18]||(e[18]=l("   ")),n(A,{modelValue:T.value,"onUpdate:modelValue":e[5]||(e[5]=t=>T.value=t),onChange:e[6]||(e[6]=t=>Q(t))},null,8,["modelValue"]),e[19]||(e[19]=l("   ")),n(i,{type:"primary",size:"large",style:{"font-size":".8em","font-weight":"bold"}},{default:u(()=>e[16]||(e[16]=[l("reactive默认开启深度监听，注册时未赋值，使用默认值，以对比展示")])),_:1,__:[16]})]),n(G),o("div",null,[e[21]||(e[21]=o("span",null,"监听ref对象",-1)),e[22]||(e[22]=l("   ")),n(i,{type:"warning",size:"large",style:{"font-size":".8em","font-weight":"bold"}},{default:u(()=>e[20]||(e[20]=[l("ref 默认不会深度监听，需要手动使用 deep:true")])),_:1,__:[20]})]),o("ul",null,[(s(!0),r(m,null,k(z.value,(t,p)=>(s(),r("li",{key:p},[K(H)(t)==="Object"?(s(),r(m,{key:0},[l(d(p)+": ",1),o("ul",null,[(s(!0),r(m,null,k(t,(D,O)=>(s(),r("li",{key:p},d(O)+": "+d(D),1))),128))])],64)):(s(),r(m,{key:1},[l(d(p)+": "+d(t),1)],64))]))),128))]),n(E,{onClick:X},{default:u(()=>e[23]||(e[23]=[l("随机生成人员信息")])),_:1,__:[23]}),n(E,{onClick:Y},{default:u(()=>e[24]||(e[24]=[l("随机修改人员信息")])),_:1,__:[24]}),n(G),o("div",null,[e[26]||(e[26]=o("span",null,"监听reactive对象 ",-1)),e[27]||(e[27]=l("   ")),n(i,{type:"warning",size:"large",style:{"font-size":".8em","font-weight":"bold"}},{default:u(()=>e[25]||(e[25]=[l("reactive 替换对象实例后失去响应性；但默认开启深度监听")])),_:1,__:[25]})]),o("ul",null,[(s(!0),r(m,null,k(K(V),(t,p)=>(s(),r("li",{key:p},[K(H)(t)==="Object"?(s(),r(m,{key:0},[l(d(p)+": ",1),o("ul",null,[(s(!0),r(m,null,k(t,(D,O)=>(s(),r("li",{key:p},d(O)+": "+d(D),1))),128))])],64)):(s(),r(m,{key:1},[l(d(p)+": "+d(t),1)],64))]))),128))]),n(E,{onClick:Z},{default:u(()=>e[28]||(e[28]=[l("随机生成人员信息")])),_:1,__:[28]}),n(E,{onClick:_},{default:u(()=>e[29]||(e[29]=[l("随机修改人员信息")])),_:1,__:[29]})]),_:1,__:[30,31]}),e[46]||(e[46]=o("br",null,null,-1)),n(q,null,{header:u(()=>e[32]||(e[32]=[l("watchEffect")])),default:u(()=>[n(i,{type:"warning",size:"large",style:{"font-size":".8em","font-weight":"bold"}},{default:u(()=>e[33]||(e[33]=[l("只会监听方法中调用的属性")])),_:1,__:[33]}),e[39]||(e[39]=o("br",null,null,-1)),n(i,{type:"warning",size:"large",style:{"font-size":".8em","font-weight":"bold"}},{default:u(()=>e[34]||(e[34]=[l("相对于watch，在 watchEffect 内改变其正在监听的变量时，不会导致无限递归或循环调用。")])),_:1,__:[34]}),e[40]||(e[40]=o("br",null,null,-1)),n(i,{type:"warning",size:"large",style:{"font-size":".8em","font-weight":"bold"}},{default:u(()=>e[35]||(e[35]=[l("默认开启immediate、deep")])),_:1,__:[35]}),e[41]||(e[41]=o("br",null,null,-1)),n(i,{type:"warning",size:"large",style:{"font-size":".8em","font-weight":"bold"}},{default:u(()=>e[36]||(e[36]=[l(" 未避免下次监听改变时 keyword 发生了变化，使用onWatcherCleanup【vue 3.5+】取消上次请求。不能在异步函数的 await 语句之后调用它 ")])),_:1,__:[36]}),e[42]||(e[42]=o("br",null,null,-1)),n(i,{type:"warning",size:"large",style:{"font-size":".8em","font-weight":"bold"}},{default:u(()=>e[37]||(e[37]=[l(" < onCleanup 函数还可以作为第三个参数传递给侦听器回调，以及 watchEffect 作用函数的第一个参数。 ")])),_:1,__:[37]}),e[43]||(e[43]=o("br",null,null,-1)),n(i,{type:"warning",size:"large",style:{"font-size":".8em","font-weight":"bold"}},{default:u(()=>e[38]||(e[38]=[l("默认异步批量触发")])),_:1,__:[38]}),e[44]||(e[44]=o("br",null,null,-1)),n(c,{modelValue:w.value,"onUpdate:modelValue":e[7]||(e[7]=t=>w.value=t),modelModifiers:{trim:!0},placeholder:"输入关键词…"},null,8,["modelValue"]),x.value?(s(),r("p",oe,"加载中...")):(s(),r("ul",ue,[(s(!0),r(m,null,k(j.value,t=>(s(),r("li",{key:t.id},d(t.title),1))),128))]))]),_:1,__:[39,40,41,42,43,44]})],64)}}};export{de as default};
